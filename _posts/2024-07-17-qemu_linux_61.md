---
layout: post
title:  "Qemu for arm64 android kernel version 6.1"
subtitle: "A way to run the latest android kernel"
header-img: img/post-bg-coffee.jpeg
date:   2024-07-17 08:00:00
author: half cup coffee
catalog: true
tags:	
    - Linux
    - Android
    - Qemu
---

# Before start

Before you start to follow this guide. You might need to read this [link](https://huangweiliang.github.io/2022/09/30/qemu-android-kernel/) first.

# Fetch the android kernel version 6.1

From this Google [link](https://source.android.com/docs/devices/cuttlefish/kernel-dev) we can get to know the branch inforamtion of android kernel.
 
~~~
 mkdir android-kernel && cd android-kernel
 repo init -u https://android.googlesource.com/kernel/manifest -b common-android14-6.1-lts
 repo sync -c -d -j8
~~~


# Necessary change need be done before build

For the folder common which is the kernel source code location.  Please do following change:

~~~
diff --git a/arch/arm64/configs/gki_defconfig b/arch/arm64/configs/gki_defconfig
index bc18ada0bd54..eeab358fa3ed 100644
--- a/arch/arm64/configs/gki_defconfig
+++ b/arch/arm64/configs/gki_defconfig
@@ -744,3 +744,17 @@ CONFIG_KUNIT=y
 CONFIG_KUNIT_DEBUGFS=y
 # CONFIG_KUNIT_DEFAULT_ENABLED is not set
 # CONFIG_RUNTIME_TESTING_MENU is not set
+
+CONFIG_INITRAMFS_SOURCE="/media/nvme1/temp/rootfs/rfs"
+CONFIG_VIRTIO_PCI=y
+CONFIG_VIRTIO_BALLOON=y
+CONFIG_VIRTIO_BLK=y
+CONFIG_VIRTIO_NET=y
+CONFIG_9P_FS_SECURITY=y
+CONFIG_NET_9P=y
+CONFIG_NET_9P_VIRTIO=y
+CONFIG_NET_9P_DEBUG=y
+CONFIG_9P_FS=y
+CONFIG_9P_FS_POSIX_ACL=y
+
+
diff --git a/build.config.gki b/build.config.gki
index 4b931d9eb333..da87a30d24e8 100644
--- a/build.config.gki
+++ b/build.config.gki
@@ -1,2 +1,2 @@
 DEFCONFIG=gki_defconfig
-POST_DEFCONFIG_CMDS="check_defconfig"
+###POST_DEFCONFIG_CMDS="check_defconfig"

~~~

